<!doctype html>
<html class="default no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>triplecheck-cli</title>
	<meta name="description" content="Documentation for triplecheck-cli">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="assets/css/main.css">
	<script async src="assets/js/search.js" id="search-script"></script>
</head>
<body>
<header>
	<div class="tsd-page-toolbar">
		<div class="container">
			<div class="table-wrap">
				<div class="table-cell" id="tsd-search" data-index="assets/js/search.json" data-base=".">
					<div class="field">
						<label for="tsd-search-field" class="tsd-widget search no-caption">Search</label>
						<input id="tsd-search-field" type="text" />
					</div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<a href="index.html" class="title">triplecheck-cli</a>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<div id="tsd-filter">
						<a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a>
						<div class="tsd-filter-group">
							<div class="tsd-select" id="tsd-filter-visibility">
								<span class="tsd-select-label">All</span>
								<ul class="tsd-select-list">
									<li data-value="public">Public</li>
									<li data-value="protected">Public/Protected</li>
									<li data-value="private" class="selected">All</li>
								</ul>
							</div>
							<input type="checkbox" id="tsd-filter-inherited" checked />
							<label class="tsd-widget" for="tsd-filter-inherited">Inherited</label>
							<input type="checkbox" id="tsd-filter-externals" checked />
							<label class="tsd-widget" for="tsd-filter-externals">Externals</label>
						</div>
					</div>
					<a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a>
				</div>
			</div>
		</div>
	</div>
	<div class="tsd-page-title">
		<div class="container">
			<h1>triplecheck-cli</h1>
		</div>
	</div>
</header>
<div class="container container-main">
	<div class="row">
		<div class="col-8 col-content">
			<div class="tsd-panel tsd-typography">
				<a href="#triplecheck-cli" id="triplecheck-cli" style="color: inherit; text-decoration: none;">
					<h1>triplecheck-cli</h1>
				</a>
				<a href="#triplecheck-cli--the-easiest-and-fastest-way-to-do-contract-testing" id="triplecheck-cli--the-easiest-and-fastest-way-to-do-contract-testing" style="color: inherit; text-decoration: none;">
					<h2>TripleCheck CLI — The easiest and fastest way to do contract testing.</h2>
				</a>
				<p><a href="https://sonarcloud.io/dashboard?id=mikaelvesavuori_triplecheck-cli"><img src="https://sonarcloud.io/api/project_badges/measure?project=mikaelvesavuori_triplecheck-cli&metric=alert_status" alt="Quality Gate Status"></a></p>
				<p><a href="https://codescene.io/projects/15674"><img src="https://codescene.io/projects/15674/status-badges/code-health" alt="CodeScene Code Health"></a></p>
				<p><a href="https://codescene.io/projects/15674"><img src="https://codescene.io/projects/15674/status-badges/system-mastery" alt="CodeScene System Mastery"></a></p>
				<p>Contract testing should be as easy and painless as unit testing, yet it never really seems to be. TripleCheck tries to remove as much of the pain as possible.</p>
				<p>The three key features of the TripleCheck eco-system are:</p>
				<ol>
					<li><strong>Smooth-as-melted-icecream two-way continuous testing</strong>, meaning all parties do testing of their dependencies and dependents, puts an end to &quot;consumer driven contracts&quot;: what we always wanted was that all sides verify respective integrity, not necessarily deep dialogues on who &quot;drives&quot; contracts/interfaces;</li>
					<li>Broker (&quot;server&quot;) acting as an (optional) lightweight <strong>global collection of all existing tests and contracts</strong>;</li>
					<li>Practically turnkey solutions ready-to-go, for common modern toolchains/architectures.</li>
				</ol>
				<p>[TODO]</p>
				<a href="#design-goals" id="design-goals" style="color: inherit; text-decoration: none;">
					<h2>Design goals</h2>
				</a>
				<ul>
					<li>Ease over rich functionality: should require minimal effort to learn and operate</li>
					<li>First grade support for serverless compute (Lambda, Cloud Run...) and databases (Fauna, Dynamo, Firestore...)</li>
					<li>First-grade support for modern CI tools (GitHub Actions, cloud provider&#39;s toolchains..)</li>
					<li>Day 1 support for modern message brokers (Google Pub/Sub, AWS Eventbridge...)</li>
					<li>Remove the need for a <em>heavyweight</em> broker</li>
					<li>Ideally zero config</li>
					<li>Lightweight: no need to mock or make actual requests, TripleCheck will compare static typed contracts</li>
					<li>Support any kind of infra and data sources</li>
				</ul>
				<p>Compared to Pact, TripleCheck cannot make deep syntactic asserts (like an expected response body), it can only ensure type and schema consistency. This is—I find—to be the true scope of contract testing. Tools like Pact are capable but, at least according to me, do too much.</p>
				<a href="#a-demo-case" id="a-demo-case" style="color: inherit; text-decoration: none;">
					<h2>A demo case</h2>
				</a>
				<p>TripleCheck CLI allows you to run tests by verifying <a href="https://json-schema.org">JSON Schemas</a> and/or plain objects that represent contracts against test objects. An example contract (plain object style) could be:</p>
				<pre><code><span style="color: #000000">[</span>
<span style="color: #000000">  {</span>
<span style="color: #000000">    </span><span style="color: #A31515">&quot;user-api&quot;</span><span style="color: #001080">:</span><span style="color: #000000"> {</span>
<span style="color: #000000">      </span><span style="color: #A31515">&quot;1.0.0&quot;</span><span style="color: #001080">:</span><span style="color: #000000"> {</span>
<span style="color: #000000">        </span><span style="color: #A31515">&quot;name&quot;</span><span style="color: #001080">:</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;Someone&quot;</span><span style="color: #000000">,</span>
<span style="color: #000000">        </span><span style="color: #A31515">&quot;address&quot;</span><span style="color: #001080">:</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;Some Street 123&quot;</span><span style="color: #000000">,</span>
<span style="color: #000000">        </span><span style="color: #A31515">&quot;age&quot;</span><span style="color: #001080">:</span><span style="color: #000000"> </span><span style="color: #098658">35</span>
<span style="color: #000000">      }</span>
<span style="color: #000000">    }</span>
<span style="color: #000000">  }</span>
<span style="color: #000000">]</span>
</code></pre>
				<p>In our list of contracts, we&#39;ve provided <code>user-api</code> with version <code>1.0.0</code> and the three fields that it expects.</p>
				<p>A basic test (again, a plain object) to verify schema integrity could look like:</p>
				<pre><code><span style="color: #000000">[</span>
<span style="color: #000000">  {</span>
<span style="color: #000000">    </span><span style="color: #A31515">&quot;user-api&quot;</span><span style="color: #001080">:</span><span style="color: #000000"> {</span>
<span style="color: #000000">      </span><span style="color: #A31515">&quot;1.0.0&quot;</span><span style="color: #001080">:</span><span style="color: #000000"> [</span>
<span style="color: #000000">        {</span>
<span style="color: #000000">          </span><span style="color: #A31515">&quot;Verify identity&quot;</span><span style="color: #001080">:</span><span style="color: #000000"> {</span>
<span style="color: #000000">            </span><span style="color: #A31515">&quot;name&quot;</span><span style="color: #001080">:</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;Carmen&quot;</span><span style="color: #000000">,</span>
<span style="color: #000000">            </span><span style="color: #A31515">&quot;address&quot;</span><span style="color: #001080">:</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;Ocean View 3000&quot;</span><span style="color: #000000">,</span>
<span style="color: #000000">            </span><span style="color: #A31515">&quot;age&quot;</span><span style="color: #001080">:</span><span style="color: #000000"> </span><span style="color: #098658">27</span>
<span style="color: #000000">          }</span>
<span style="color: #000000">        }</span>
<span style="color: #000000">      ]</span>
<span style="color: #000000">    }</span>
<span style="color: #000000">  }</span>
<span style="color: #000000">]</span>
</code></pre>
				<p>To test the contract, we construct an array of tests for any services and their versions. This makes it easy to co-locate both contracts and tests in single files, or to assemble them programmatically. You can use a combination of local and/or remote tests and contracts.</p>
				<p>Notice that the exact syntax is not validated, but instead the shape [TODO: Syntax vs Semantics]. Under the hood TripleCheck uses <a href="https://quicktype.io">Quicktype</a> to do this checking. It&#39;s recommended to use <a href="https://json-schema.org">JSON Schema</a> for more complex usecases. It also makes it easier to be concrete about actual types and what fields are required.</p>
				<a href="#terminology" id="terminology" style="color: inherit; text-decoration: none;">
					<h2>Terminology</h2>
				</a>
				<ul>
					<li>Test/verify: When you test compatibility between two or more contracts</li>
					<li>Publish contract: When you make a local contract public (adding/updating) in the shared data source</li>
				</ul>
				<a href="#workflow" id="workflow" style="color: inherit; text-decoration: none;">
					<h2>Workflow</h2>
				</a>
				<p>Contracts should be &quot;owned&quot; by the respective services. The individual service is primarily responsible for creating, updating and publishing their contract.</p>
				<p>Tests can be written by anyone who has a dependency toward a given service.</p>
				<p>Send back data, having resolved dependencies, given that someone has already published contracts and tests (and that dependencies / dependents have been calculated) you&#39;ll get all related data back.</p>
				<ul>
					<li><strong>You get back data for your service</strong>: Ensure functionality of what others need of you</li>
					<li><strong>You get back data for services you depend on</strong>: Ensure functionality of what you need of others</li>
				</ul>
				<a href="#development-flow" id="development-flow" style="color: inherit; text-decoration: none;">
					<h2>Development flow</h2>
				</a>
				<p>The approach with TripleCheck may be more naive than with Pact. In TripleCheck, there is no forced two-way verification, so any change you make will not start any other processes. It&#39;s really just like a lightweight mocked integration test.</p>
				<p>Below I will list two typical cases. Of course a system/service/app/API can have <em>both</em> dependents and dependencies.</p>
				<a href="#one-contract-per-service" id="one-contract-per-service" style="color: inherit; text-decoration: none;">
					<h3>One contract per service</h3>
				</a>
				<p>Each service should abide by one contract. This contract may have multiple versions.</p>
				<a href="#one-local-test-file" id="one-local-test-file" style="color: inherit; text-decoration: none;">
					<h3>One local test file</h3>
				</a>
				<p>All tests are collected in a single file. This can contain tests for any number of services and versions.</p>
				<a href="#use-the-remote-collections-of-tests-and-contracts" id="use-the-remote-collections-of-tests-and-contracts" style="color: inherit; text-decoration: none;">
					<h3>Use the remote collections of tests and contracts</h3>
				</a>
				<p>Make sure to publish collections to the remote data storage. Only keep locally the minimum number of things you need. For a typical provider it would be your own service (provider) contract and your tests.</p>
				<p>Use <code>testScope</code> and <code>excludeScope</code> in the configuration to decide what you actually need to test.</p>
				<a href="#consumer-updates-their-application-that-depends-on-an-api" id="consumer-updates-their-application-that-depends-on-an-api" style="color: inherit; text-decoration: none;">
					<h3>Consumer updates their application that depends on an API</h3>
				</a>
				<p>TODO.</p>
				<a href="#provider-updates-their-api-that-has-several-applications-depending-on-it" id="provider-updates-their-api-that-has-several-applications-depending-on-it" style="color: inherit; text-decoration: none;">
					<h3>Provider updates their API that has several applications depending on it</h3>
				</a>
				<p>TODO.</p>
				<a href="#example-broker-implementations" id="example-broker-implementations" style="color: inherit; text-decoration: none;">
					<h2>Example broker implementations</h2>
				</a>
				<p>There are several broker implementations that you can use right away or as the basis of your own starter kit. The current list is:</p>
				<ul>
					<li><a href="https://github.com/mikaelvesavuori/triplecheck-example-cloudrun">Google Cloud Run and Firestore</a></li>
					<li><a href="https://github.com/mikaelvesavuori/triplecheck-example-cloud-functions">Google Cloud Functions and Firestore</a></li>
					<li><a href="https://github.com/mikaelvesavuori/triplecheck-example-cloudflare-workers">Cloudflare Workers and KV</a></li>
					<li><a href="https://github.com/mikaelvesavuori/triplecheck-example-lambda">AWS Lambda with DynamoDB</a></li>
					<li><a href="https://github.com/mikaelvesavuori/triplecheck-example-vercel">Vercel with FaunaDB</a></li>
					<li><a href="https://github.com/mikaelvesavuori/triplecheck-example-netlify">Netlify with FaunaDB</a></li>
				</ul>
				<p>Read more over at <a href="https://github.com/mikaelvesavuori/triplecheck-broker">triplecheck-broker</a> for details on these.</p>
				<a href="#sync-schemas-from-aws-eventbridge-and-google-cloud-platform-pubsub" id="sync-schemas-from-aws-eventbridge-and-google-cloud-platform-pubsub" style="color: inherit; text-decoration: none;">
					<h2>Sync schemas from AWS EventBridge and Google Cloud Platform Pub/Sub</h2>
				</a>
				<p>Add one/both of these to your <code>package.json</code> scripts:</p>
				<pre><code><span style="color: #A31515">&quot;sync:aws&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;sh node_modules/triplecheck-cli/generate-schemas-from-aws.sh your-registry-name&quot;</span><span style="color: #000000">,</span>
<span style="color: #A31515">&quot;sync:gcp&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;sh node_modules/triplecheck-cli/generate-schemas-from-gcp.sh&quot;</span>
</code></pre>
				<p>Don&#39;t forget to change your registry name if you want to use the AWS option.</p>
				<p>Note that the shell scripts have no logic and will not take any options from your TripleCheck configuration. Feel free to copy and modify these shell scripts if you want to extend them with more functionality.</p>
				<a href="#references" id="references" style="color: inherit; text-decoration: none;">
					<h2>References</h2>
				</a>
				<ul>
					<li><a href="https://www.fastify.io/docs/v2.2.x/Validation-and-Serialization/">https://www.fastify.io/docs/v2.2.x/Validation-and-Serialization/</a></li>
					<li><a href="https://github.com/pact-foundation/pact-js/blob/master/examples/graphql/src/consumer.spec.ts">https://github.com/pact-foundation/pact-js/blob/master/examples/graphql/src/consumer.spec.ts</a></li>
					<li><a href="https://docs.pact.io/getting_started/how_pact_works">https://docs.pact.io/getting_started/how_pact_works</a></li>
					<li><a href="https://docs.pact.io/5-minute-getting-started-guide/">https://docs.pact.io/5-minute-getting-started-guide/</a></li>
					<li><a href="https://github.com/pact-foundation/pact-js/tree/master/examples/e2e">https://github.com/pact-foundation/pact-js/tree/master/examples/e2e</a></li>
					<li><a href="https://blog.dennisokeeffe.com/blog/2020-09-20-generating-types-with-quicktype/">https://blog.dennisokeeffe.com/blog/2020-09-20-generating-types-with-quicktype/</a></li>
					<li><a href="https://json-schema.org/understanding-json-schema/structuring.html">https://json-schema.org/understanding-json-schema/structuring.html</a></li>
				</ul>
			</div>
		</div>
		<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
			<nav class="tsd-navigation primary">
				<ul>
					<li class=" ">
						<a href="modules.html">Exports</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/contracts_call.html">contracts/<wbr>Call</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/contracts_config.html">contracts/<wbr>Config</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/contracts_consoleoutput.html">contracts/<wbr>Console<wbr>Output</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/contracts_contract.html">contracts/<wbr>Contract</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/contracts_data.html">contracts/<wbr>Data</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/contracts_http.html">contracts/<wbr>Http</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/contracts_service.html">contracts/<wbr>Service</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/controllers_triplecheckcontroller.html">controllers/<wbr>Triple<wbr>Check<wbr>Controller</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/entities_triplecheck.html">entities/<wbr>Triple<wbr>Check</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/frameworks_config_initconfig.html">frameworks/config/init<wbr>Config</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/frameworks_config_validateconfig.html">frameworks/config/validate<wbr>Config</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/frameworks_convert_converttoquicktype.html">frameworks/convert/convert<wbr>ToQuicktype</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/frameworks_convert_createcontractfile.html">frameworks/convert/create<wbr>Contract<wbr>File</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/frameworks_convert_getcontract.html">frameworks/convert/get<wbr>Contract</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/frameworks_convert_writecontracttodisk.html">frameworks/convert/write<wbr>Contract<wbr>ToDisk</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/frameworks_data_clean.html">frameworks/data/clean</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/frameworks_data_mergedatasets.html">frameworks/data/merge<wbr>Datasets</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/frameworks_filesystem_checkifexists.html">frameworks/filesystem/check<wbr>IfExists</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/frameworks_filesystem_write.html">frameworks/filesystem/write</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/frameworks_load_loaddatalocal.html">frameworks/load/load<wbr>Data<wbr>Local</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/frameworks_load_loaddataremote.html">frameworks/load/load<wbr>Data<wbr>Remote</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/frameworks_text_consoleoutput.html">frameworks/text/console<wbr>Output</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/frameworks_text_messages.html">frameworks/text/messages</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/index.html">index</a>
					</li>
				</ul>
			</nav>
			<nav class="tsd-navigation secondary menu-sticky">
				<ul class="before-current">
				</ul>
			</nav>
		</div>
	</div>
</div>
<footer class="with-border-bottom">
	<div class="container">
		<h2>Legend</h2>
		<div class="tsd-legend-group">
			<ul class="tsd-legend">
				<li class="tsd-kind-variable"><span class="tsd-kind-icon">Variable</span></li>
				<li class="tsd-kind-function"><span class="tsd-kind-icon">Function</span></li>
				<li class="tsd-kind-type-alias"><span class="tsd-kind-icon">Type alias</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-class"><span class="tsd-kind-icon">Class</span></li>
			</ul>
		</div>
	</div>
</footer>
<div class="container tsd-generator">
	<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p>
</div>
<div class="overlay"></div>
<script src="assets/js/main.js"></script>
</body>
</html>